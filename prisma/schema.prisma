generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// Category model - maps to "categories" collection in MongoDB
model Category {
  id               String @id @default(auto()) @map("_id") @db.ObjectId
  categoryId       Int    @unique(map: "id_1") @map("id")
  name             String
  parentCategory   String
  serialNumber     String
  subcategories    Json?
  topLevelCategory String
  url              String

  @@map("categories")
}

// Product model - maps to "products" collection in MongoDB
model Product {
  id               String      @id @default(auto()) @map("_id") @db.ObjectId
  category         String
  categoryId       Int
  image            String
  link             String
  parentCategory   String
  price            Int
  productId        String      @unique(map: "productId_1")
  rating           String
  reviewCount      Int
  scrapedAt        String
  title            String
  topLevelCategory String

  // Relations
  orderItems       OrderItem[]

  @@index([category], map: "category_1")
  @@index([topLevelCategory], map: "topLevelCategory_1")
  @@index([price], map: "price_1")
  @@index([rating], map: "rating_1")
  @@map("products")
}

// Order model for managing customer orders
model Order {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  orderItems    OrderItem[]

  // Payment Information
  isPaid        Boolean     @default(false)
  paymentMethod String      @default("cod")
  paymentId     String?
  paymentStatus String      @default("pending")

  // Customer Information
  userId        String?
  customerName  String      @default("")
  customerEmail String      @default("")
  phone         String      @default("")
  address       String      @default("")

  // Order totals
  totalAmount   Int         @default(0)
  orderStatus   String      @default("PENDING")

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([userId])
  @@map("orders")
}

// OrderItem model for individual items in an order
model OrderItem {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  orderId     String  @db.ObjectId
  order       Order   @relation(fields: [orderId], references: [id])
  productId   String  @db.ObjectId
  product     Product @relation(fields: [productId], references: [id])
  productName String
  quantity    Int     @default(1)
  price       Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([orderId])
  @@index([productId])
  @@map("orderitems")
}

// ProductDetails model - maps to "productDetails" collection in MongoDB
// Contains detailed product information including reviews, images, shipping info
model ProductDetails {
  id               String  @id @default(auto()) @map("_id") @db.ObjectId
  productId        String  @unique
  catalogId        String?
  category         String?
  categoryId       Int?
  data             Json?   // Contains: images, description, reviews, shipping, suppliers, etc.
  image            String?
  link             String?
  parentCategory   String?
  price            Int?
  rating           String?
  reviewCount      Int?
  scrapedAt        String?
  title            String?
  topLevelCategory String?

  @@map("productDetails")
}
